<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile</title>
  <link rel="stylesheet" href="/css/profile.css">
</head>

<body>

<!-- PROFILE HEADER -->
<div class="profile-header">
  <!-- LEFT: USER INFO -->
  <div class="user-info">
    <% // Remove any characters that are not letters, spaces, or hyphens const
      cleanName=user.name.replace(/[^a-zA-Z\s-]/g, '' ).trim(); // Split by space or hyphen const
      nameParts=cleanName.split(/[\s-]+/).filter(n=> n.length > 0);
      // Get initials
      let initials = '';
      if (nameParts.length === 0) {
      initials = '?';
      } else if (nameParts.length === 1) {
      initials = nameParts[0][0].toUpperCase();
      } else {
      initials = nameParts[0][0].toUpperCase() + nameParts[1][0].toUpperCase();
      }
      %>
      <div class="profile-pic">
        <%= initials %>
      </div>

    <div class="user-details">
      <div class="username"><%= user.name %></div>
      <div class="email"><%= user.email %></div>
    </div>
  </div>

  <!-- RIGHT: ACTIONS -->
  <div class="header-actions">
    <a href="/api/home" class="header-link">
      <img src="/icons/Homewhite.svg" alt="home" class="icon"> Home
    </a>

    <form action="/api/user/logout" method="GET">
      <button type="submit" class="logout-btn">
        <img src="/icons/logoutwhite.svg" alt="logout" class="icon"> Logout
      </button>
    </form>
  </div>
</div>


<div class="tabs">
  <button class="tab-btn active" data-tab="saved">Saved</button>
  <button class="tab-btn" data-tab="comments">Comments</button>
  <button class="tab-btn" data-tab="likes">Likes</button>
  <button class="tab-btn" data-tab="replies">Replies</button>
</div>


<div class="tab-content">
  <!-- Saved Reels -->
<div id="saved" class="tab-panel active">
  <% if (savedReels.length > 0) { %>
    <div class="saved-grid">
      <% savedReels.forEach(reel => { %>
        <!-- Updated href to point to home with targetReelId -->
        <a href="/api/home?reelId=<%= reel.id %>" class="saved-card">

          <!-- Video preview -->
          <div class="video-section">
            <video src="<%= reel.video %>" muted loop class="saved-video"></video>

            <!-- Title and icons on top of the video -->
            <div class="saved-overlay">
              <!-- Video Title on Left -->
              <div class="saved-title">
                <strong><%= reel.name %></strong>
              </div>

              <!-- Icons on Right (Stacked Vertically) -->
              <div class="saved-icons">
                <div><img src="/icons/Likewhite.svg" alt="likes"></div>
                <div class="icon-count"><%= reel.likes_count %></div>
                <div><img src="/icons/commentwhite.svg" alt="comments"></div>
                <div class="icon-count"><%= reel.comments_count %></div>
              </div>
            </div>

          </div>

        </a>
      <% }) %>
    </div>
  <% } else { %>
    <div class="empty">No saved reels yet.</div>
  <% } %>
</div>

  <!-- Comments -->
  <div id="comments" class="tab-panel">
  <% if (comments.length > 0) { %>
    <div class="comments-list">
      <% comments.forEach(c => { %>
        <div class="comment-card">

          <!-- Optional video preview -->
          <video src="<%= c.video %>" muted loop class="comment-video"></video>

          <!-- Reel info -->
          <div class="comment-reel">
            ðŸŽ¥ <span><%= c.reel_name %></span>
          </div>

          <!-- Comment text -->
          <p class="comment-text">
            <strong>You commented:</strong> <%= c.comment %>
          </p>

          <!-- Comment time (placed at the end) -->
          <div class="comment-time">
            <%= new Date(c.created_at).toLocaleString() %>
          </div>
         

          

        </div>
      <% }) %>
    </div>
  <% } else { %>
    <div class="empty">No comments yet.</div>
  <% } %>
</div>
  <!-- Likes -->
  <div id="likes" class="tab-panel">
  <% if (likes.length > 0) { %>
    <div class="likes-list">
      <% likes.forEach(like => { %>
        <!-- current route is not working need to make it working -->
        <!-- <a href="/api/home?reelId= like.id" class="like-card">  -->

          <!-- Video preview -->
          <video src="<%= like.video %>" muted loop class="like-video"></video>

          <!-- Video title / name -->
          <div class="like-overlay">
            <div class="like-title"><strong><%= like.name %></strong></div>
          </div>
          
          <!-- Optional: like time if you track it -->
          <% if (like.created_at) { %>
            <div class="like-time">
              <%= new Date(like.created_at).toLocaleString() %>
            </div>
          <% } %>

        </a>
      <% }) %>
    </div>
  <% } else { %>
    <div class="empty">No likes yet.</div>
  <% } %>
</div>

<!-- Replies -->
<div id="replies" class="tab-panel">
  <% if (replies.length > 0) { %>
    <div class="replies-list">
      <% replies.forEach(r => { %>
        <div class="reply-card">

          <!-- Reply text -->
          <p class="reply-text">
            <strong>You replied:</strong> <%= r.reply %>
          </p>

          <!-- Original comment -->
          <p class="reply-comment">
            ðŸ’¬ <em><%= r.comment %></em>
          </p>

          <!-- Reel info -->
          <div class="reply-reel">
            <span>ðŸŽ¥ <%= r.name %></span>
          </div>

        </div>
      <% }) %>
    </div>
  <% } else { %>
    <div class="empty">No replies yet.</div>
  <% } %>
</div>

</div>
<script>
  const buttons = document.querySelectorAll('.tab-btn');
  const panels = document.querySelectorAll('.tab-panel');

  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      buttons.forEach(b => b.classList.remove('active'));
      panels.forEach(p => p.classList.remove('active'));

      btn.classList.add('active');
      document.getElementById(btn.dataset.tab).classList.add('active');
    });
  });
</script>

</body>
</html>
