<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home | Reels</title>
    <link rel="stylesheet" href="/css/reel.css">
</head>

<body>

    <div class="reels-container">

<% reels.forEach(reel => { %>
  <div class="reel" data-reel-id="<%= reel.id %>">

    <!-- VIDEO -->
    <div class="video-wrapper">
      <video src="<%= reel.video %>" autoplay muted loop class="reel-video"></video>
    </div>

    <!-- INFO -->
    <div class="bottom-left-overlay">
      <h4>@<%= reel.reel_name %></h4>
      <p><%= reel.description %></p>

      <a href="/api/store/<%= reel.partner_id %>">
        <button><%= reel.partner_name %> Store</button>
      </a>
    </div>

    <!-- ICONS -->
    <!-- <div class="right-icons">
      <button class="like-btn"> <img src="/icons/heartwhite.svg" alt="like"></button>
      <button class="comment-btn"> <img src="/icons/commentwhite.svg" alt="comment"></button>
      <button class="save-btn"> <img src="/icons/savewhite.svg" alt="save"></button>
    </div> -->
    <!-- ICONS -->
<div class="right-icons">

  <button class="like-btn">
    <img src="/icons/heartwhite.svg" alt="like">
    <span class="count"><%= reel.likes_count %></span>
  </button>

  <button class="comment-btn">
    <img src="/icons/commentwhite.svg" alt="comment">
    <span class="count"><%= reel.comments_count %></span>
  </button>

  <button class="save-btn">
    <img src="/icons/savewhite.svg" alt="save">
    <span class="count"><%= reel.saves_count %></span>
  </button>

</div>


    <!-- MOBILE COMMENT SHEET -->
    <div class="comment-sheet">

      <div class="comment-header">
        <span>Comments</span>
        <button class="close-comment">✕</button>
      </div>

      <div class="comment-list">
        <!-- comments injected here -->
      </div>

      <form class="comment-form">
        <input
          type="text"
          placeholder="Add a comment…"
          name="comment"
          required
        />
        <button type="submit">Post</button>
      </form>

    </div>

  </div>
<% }) %>

</div>

    
    <!-- FIXED FULL-WIDTH BOTTOM NAV -->
    <div class="bottom-nav">
    <a href="/api/home" class="nav-item">
        <img src="/icons/homewhite.svg" alt="home">
        <p>Home</p>
    </a>
    <a href="/user/profile" class="nav-item">
        <img src="/icons/profilewhite.svg" alt="profile">
        <p>Saved</p>
    </a>
</div>

</body>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const targetReelId = "<%= targetReelId %>";
    if (!targetReelId) return;

    const reel = document.querySelector(`.reel[data-reel-id="${targetReelId}"]`);
    if (reel) {
        reel.scrollIntoView({ behavior: "smooth", block: "center" });

        const video = reel.querySelector("video");
        if (video) video.play().catch(() => {});
    }
});

</script>
<script src="/js/script.js"></script>
</html>