<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home | Reels</title>
    <link rel="stylesheet" href="/css/reel.css">
</head>

<body>

<div class="reels-container">

<% reels.forEach(reel => { %>
  <div class="reel" data-reel-id="<%= reel.id %>">

    <!-- VIDEO -->
    <div class="video-wrapper">
      <!-- <video src=" reel.video " autoplay muted loop class="reel-video"></video> -->
      
      <video data-src="<%= reel.video %>" class="reel-video" muted></video>

    </div>

    <!-- INFO -->
    <div class="bottom-left-overlay">
      <h4>@<%= reel.reel_name %></h4>
      <p><%= reel.description %></p>

      <a href="/api/store/<%= reel.partner_id %>">
        <button>üè¨ <%= reel.partner_name %> Store</button>
      </a>
    </div>

    
<div class="right-icons">
  <button class="like-btn <%= reel.liked_by_user ? 'active' : '' %>">
    <img src="/icons/Heartwhite.svg" alt="like">
  </button>

  <button class="save-btn <%= reel.saved_by_user ? 'active' : '' %>">
    <img src="/icons/savewhite.svg" alt="save">
  </button>

  <button class="comment-btn">
    <img src="/icons/commentwhite.svg" alt="comment">
  </button>
</div>



    <!-- MOBILE COMMENT SHEET -->
    <div class="comment-sheet">

      <div class="comment-header">
        <span>Comments</span>
        <button class="close-comment">‚úï</button>
      </div>

      <div class="comment-list">
     <!-- comments appear here -->
      </div>

      <form class="comment-form">
        <input
          type="text"
          placeholder="Add a comment‚Ä¶"
          name="comment"
          required
        />
        <button type="submit">Post</button>
      </form>

    </div> 

  </div>
<% }) %>

</div>










    <!-- FIXED FULL-WIDTH BOTTOM NAV -->
    <div class="bottom-nav">
    <a href="/api/home" class="nav-item">
        <img src="/icons/Homewhite.svg" alt="home">
        <p>Home</p>
    </a>
    <a href="/user/profile" class="nav-item">
        <img src="/icons/profilewhite.svg" alt="profile">
        <p>Saved</p>
    </a>
</div>
</body>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const targetReelId = "<%= targetReelId %>";
    if (!targetReelId) return;

    const reel = document.querySelector(`.reel[data-reel-id="${targetReelId}"]`);
    if (reel) {
        reel.scrollIntoView({ behavior: "smooth", block: "center" });

        const video = reel.querySelector("video");
        if (video) video.play().catch(() => {});
    }
});

</script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const videos = document.querySelectorAll('video[data-src]');

    const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const video = entry.target;
                video.src = video.dataset.src; // load video
                video.play().catch(() => {}); // autoplay
                observer.unobserve(video); // stop observing
            }
        });
    }, { threshold: 0.5 });

    videos.forEach(video => observer.observe(video));
});
</script>


<script src="/js/script.js"></script>
</html>